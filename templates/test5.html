<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>テスト2回目</title>
</head>
<body>
  <h1>チケット判定2回目</h1>

  <form class="container">
    <div class="group">
      <p>年齢を入力してください。</p>
      <input id="age" type="number" placeholder="年齢を入力" min="0">
    </div>

    <div class="group">
      <p>学生ですか？</p>
      <label><input type="radio" name="student" value="true">はい</label>
      <label><input type="radio" name="student" value="false">いいえ</label>
    </div>

    <div class="group">
      <p>祝日ですか？</p>
      <label><input type="radio" name="holiday" value="true">はい</label>
      <label><input type="radio" name="holiday" value="false">いいえ</label>
    </div>

    <div class="group">
      <p>お住まいは地元ですか？</p>
      <label><input type="radio" name="resident" value="local">地元</label>
      <label><input type="radio" name="resident" value="other">地元以外</label>
    </div>

    <button id="send" type="button">送信</button>

    <p id="result" class="result">ここに結果を表示します。</p>

  </form>

  <script>
    const ageInput = document.getElementById("age");
    const sendBtn = document.getElementById("send");
    const resultBox = document.getElementById("result");

    sendBtn.addEventListener("click", async () => {
      const age = ageInput.valueAsNumber;
      const studentEl = document.querySelector('input[name="student"]:checked');
      const holidayEl = document.querySelector('input[name="holiday"]:checked');
      const residentEl = document.querySelector('input[name="resident"]:checked');

      if (!Number.isFinite(age) || !studentEl || !holidayEl || !residentEl) {
        resultBox.textContent = "年齢や項目をすべて入力・選択してください。";
        return;
      }

      const student = (studentEl.value === "true");
      const holiday = (holidayEl.value === "true");
      const resident = residentEl.value;

      console.log({ age, student, holiday, resident });

      try {
        const res = await fetch("/api/ticket", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ age, student, holiday, resident})
        });

        const data = await res.json();

        resultBox.textContent = data.ok ? data.message : (data.message || "サーバーでエラーが発生しました。");
      } catch (e) {
        resultBox.textContent = "通信エラーが発生しました。";
        console.error(e)
      }
    });
  </script>
</body>
</html>